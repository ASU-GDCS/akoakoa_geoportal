System.register(["jimu-core","jimu-arcgis","jimu-ui","jimu-core/react"],(function(e,t){var o={},r={},i={},s={};return{setters:[function(e){o.React=e.React,o.css=e.css,o.jsx=e.jsx,o.portalUrlUtils=e.portalUrlUtils},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.Button=e.Button,i.ButtonGroup=e.ButtonGroup,i.CollapsablePanel=e.CollapsablePanel,i.Icon=e.Icon,i.Popper=e.Popper,i.Switch=e.Switch},function(e){s.useEffect=e.useEffect,s.useRef=e.useRef,s.useState=e.useState}],execute:function(){e((()=>{var e={976:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m13.333 5-2.666-2H5.333L2.667 5zM2 14V6h12v8zM5 2h6l4 3v10H1V5zm.5 5c0 .333.203.696.656.998.45.3 1.1.502 1.844.502.743 0 1.394-.202 1.844-.502.454-.302.656-.665.656-.998h1c0 .771-.47 1.409-1.101 1.83-.636.424-1.486.67-2.399.67s-1.763-.246-2.399-.67C4.97 8.41 4.5 7.771 4.5 7z" clip-rule="evenodd"></path></svg>'},884:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1 1v14h14V1zm9.082 13c-.005-.037-.113-.274-.122-.309a1.5 1.5 0 0 0 .718-1.267 1.2 1.2 0 0 0-.053-.358c.152-.176.263-.383.326-.607q.046.003.093.003c.3.002.593-.091.836-.266q.06.066.126.124c.42.412.977.654 1.564.68H14v2h-3.918M14 11h-.43a1.46 1.46 0 0 1-.906-.433c-.264-.23-.258-.782-.617-.782-.482 0-.52.677-1.003.677-.219 0-.38-.177-.599-.177-.193 0-.445.102-.445.293v.502c0 .424-.506.508-.506.934 0 .171.184.236.184.41 0 .58-.893.502-.893 1.08 0 .191.215.305.215.486V14H6.375q.087-.243.09-.502c0-.547-1.043-.393-1.207-.72-.407-.813.693-1.022.693-1.673 0-.16-.082-.488-.334-.513-.351-.035-.443.154-.797.154a.406.406 0 0 1-.437-.36c0-.386.308-.566.308-.952 0-.25-.102-.393-.102-.643a.62.62 0 0 1 .59-.643c.323 0 .464.264.618.54a.64.64 0 0 0 .617.308c.49 0 .798-.61.798-.977a.47.47 0 0 1 .437-.488c.347 0 .476.36.824.36.57 0 .55-.756 1.053-1.03.618-.332.438-1.052.36-1.44-.032-.169.29-.5.464-.487.72.05.412-.54.412-.823q0-.073.022-.142c.111-.332.595-.438.595-.836 0-.281-.233-.41-.233-.693a.65.65 0 0 1 .22-.44H14zM2 14V2h8.278c-.013.077-.132.356-.132.44 0 .194.038.387.112.567a1.6 1.6 0 0 0-.422.643 1.4 1.4 0 0 0-.074.442 1.7 1.7 0 0 0-.536.43 1.32 1.32 0 0 0-.32 1.091q.046.205.066.414a2 2 0 0 0-.649.67 1.46 1.46 0 0 0-.674-.166 1.45 1.45 0 0 0-1.383 1.086 1.44 1.44 0 0 0-1.086-.469 1.62 1.62 0 0 0-1.591 1.643c0 .254.113.293.084.574s-.29.535-.29 1.022a1.37 1.37 0 0 0 .984 1.29 1.58 1.58 0 0 0-.003 1.549c.143.286.636.774.534.774z"></path></svg>'},686:e=>{"use strict";e.exports=r},244:e=>{"use strict";e.exports=o},972:e=>{"use strict";e.exports=s},321:e=>{"use strict";e.exports=i}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var a={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(a),n.d(a,{LayerGroup:()=>h,__set_webpack_public_path__:()=>y,default:()=>m});var e=n(244),t=n(686),o=n(321),r=n(972),i=function(e,t,o,r){return new(o||(o=Promise))((function(i,s){function n(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((r=r.apply(e,t||[])).next())}))};function s(t){const r=t.item,s=t.mapview,n=t.theme,a=[],l=r.layerRef,c=l.portalItem;function u(e,t,o){return i(this,void 0,void 0,(function*(){const r="geojson"===t?"geojson":"csv",i="geojson"===t?"application/json":"text/csv",s=new Blob([e],{type:i});try{if(window.showSaveFilePicker){const e={suggestedName:`${o}.${r}`,types:[{description:"geojson"===t?"GeoJSON File":"CSV File",accept:{[i]:[`.${r}`]}}]},n=yield window.showSaveFilePicker(e),a=yield n.createWritable({keepExistingData:!1});yield a.write(s),yield a.close()}else{const e=window.URL.createObjectURL(s),t=document.createElement("a");t.href=e,t.download=`${o}.${r}`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e)}}catch(e){console.error("Error saving file:",e),alert("There was an error saving the file. Please try again with a different filename or ensure that a file with the same name is not currently open on your computer.")}}))}c.portal.url&&c.id&&a.push({id:"information",label:"Layer Info",enabled:!0}),a.push({id:"zoomTo",label:"Zoom to Layer",enabled:!0}),"feature"===l.type&&(l.sourceJSON&&l.sourceJSON.supportedExportFormats.includes("csv")&&a.push({id:"exportcsv",label:"Export to CSV",enabled:!0}),l.sourceJSON&&l.sourceJSON.supportedExportFormats.includes("geojson")&&a.push({id:"exportjson",label:"Export to GeoJSON",enabled:!0}));const p=(e,t)=>i(this,void 0,void 0,(function*(){try{if("feature"===t.type){const o=t,r=yield o.queryExtent();r&&r.extent&&(yield e.view.goTo(r.extent,{duration:1e3}))}else t.fullExtent&&(yield e.view.goTo(t.fullExtent,{duration:1e3}))}catch(e){console.error("Error zooming to layer:",e)}})),d=e.css`
    background: ${n.colors.palette.secondary[600]};
    text-align: left;
    border-radius: 0;

    &:hover {
      background: ${n.colors.palette.primary[600]}; // Darker shade on hover
    }
  `;return e.React.createElement(o.ButtonGroup,{variant:"text",vertical:!0,block:!0,size:"sm",backgroundColor:n.colors.palette.primary},a.map((t=>e.React.createElement(o.Button,{block:"true",onClick:()=>{(t=>{var o;switch(t){case"zoomTo":p(s,r.layerRef);break;case"exportjson":const t=r.layerRef.createQuery();t.outSpatialReference={wkid:4326},t.returnGeometry=!0,t.outFields=["*"],r.layerRef.queryFeatures(t).then((function(e){const t={type:"FeatureCollection",features:e.features.map((function(e){const t=e.geometry.toJSON();let o={type:null,coordinates:null};return t.rings?(o.type="Polygon",o.coordinates=t.rings):t.paths?(o.type="LineString",o.coordinates=t.paths[0]):t.points?(o.type="MultiPoint",o.coordinates=t.points):void 0!==t.x&&void 0!==t.y&&(o.type="Point",o.coordinates=[t.x,t.y]),{type:"Feature",geometry:o,properties:e.attributes}})),crs:{type:"name",properties:{name:"EPSG:4326"}}};u(JSON.stringify(t,null,2),"geojson",r.title)}));break;case"exportcsv":const i=r.layerRef.createQuery();i.outSpatialReference={wkid:4326},i.returnGeometry=!0,i.outFields=["*"],r.layerRef.queryFeatures(i).then((function(e){const t=e.features;if(0===t.length)return;const o=Object.keys(t[0].attributes);u([o.join(","),...t.map((e=>o.map((t=>e.attributes[t])).join(",")))].join("\n"),"csv",r.title)}));break;case"information":const n=r.layerRef.portalItem;if(console.info("portal item:",n),n.portal.url&&n.id){const t=e.portalUrlUtils.getStandardPortalUrl(n.portal.url)+`/home/item.html?id=${n.id}`;window.open(t)}else{const e="feature"===(null===(o=r.layerRef)||void 0===o?void 0:o.type)?`${r.layerRef.url}/${r.layerRef.layerId}`:r.layerRef.url;window.open(e)}}})(t.id)},css:d},t.label))))}var l=n(884),c=n.n(l);function u(t){const i=t.mapview,n=t.theme,a=t.item,l=t.onchange,[u,p]=(0,r.useState)(!1),d=(0,r.useRef)(null),h=(0,r.useRef)(null),[m,y]=(0,r.useState)(!1),f=e.css`
    display: flex;
    width: 100%;
    margin-left: ${n.sizes[3]};
    margin-top: ${n.sizes[1]};
    color: ${n.colors.palette.dark[800]};
  `,v=e.css`
    word-wrap: break-word;
    white-space: normal;
    margin-left: ${n.sizes[2]};
    font-weight: normal;
    color: ${n.colors.palette.dark[800]};
  `,w=e.css`
    word-wrap: break-word;
    white-space: normal;
    margin-left: ${n.sizes[1]};
    font-weight: normal;
    color: ${n.colors.palette.dark[800]};
  `;(0,r.useEffect)((()=>{const e=e=>{u&&h.current&&d.current&&!h.current.contains(e.target)&&!d.current.contains(e.target)&&p(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[u]);const g=()=>{d.current&&p(!u)};return(0,e.jsx)("div",{key:a.id,css:f},(0,e.jsx)(o.Switch,{checked:a.visible,onChange:e=>l(a.id,e.target.checked)}),(0,e.jsx)("span",{css:v},(0,e.jsx)(o.Icon,{icon:c()}),(0,e.jsx)("div",{style:{display:"inline-block"},ref:d},(0,e.jsx)("span",{css:v},a.title),(0,e.jsx)("span",{style:{fontWeight:m?"bold":"normal",cursor:"pointer"},css:w,onClick:g,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1)},"..."),(0,e.jsx)(o.Popper,{showArrow:!1,strategy:"fixed",autoSize:!0,reference:d,onClick:g,onClose:()=>p(!1),placement:"auto",open:u},(0,e.jsx)("div",{ref:h},(0,e.jsx)(s,{item:a,theme:n,mapview:i}))))))}var p=n(976),d=n.n(p);function h({mapview:t,theme:r,item:i,onchange:s}){var n;const a=e.css`
    color: ${r.colors.palette.primary[500]};
    margin-left: ${r.sizes[2]};
    font-weight: bold;
    font-size: ${r.typography.sizes.body2};
    word-wrap: break-word;
    white-space: normal;
    margin-top: ${r.sizes[1]};
    margin-right: ${r.sizes[4]};
  `,l=null===(n=i.children)||void 0===n?void 0:n.map((o=>o.isGroup?(0,e.jsx)(h,{mapview:t,theme:r,item:o,onchange:s}):(0,e.jsx)(u,{mapview:t,theme:r,item:o,onchange:s})));return i.root?(0,e.jsx)("div",null,l):(0,e.jsx)("div",{key:i.id,css:a},(0,e.jsx)(o.CollapsablePanel,{label:i.title,leftIcon:d(),level:!0,defaultIsOpen:i.level<1},(0,e.jsx)("div",null,l)))}class m extends e.React.PureComponent{constructor(e){super(e),this.activeViewChangeHandler=e=>{e&&this.setState({jimuMapView:e},(()=>{this.updateLayersList(),this.state.jimuMapView.view.map.allLayers.on("change",(()=>{this.updateLayersList()}))}))},this.processLayerStructure=(e,t=0,o=[])=>e.toArray().map((e=>{const r=this.state.jimuMapView.view.map.basemap.baseLayers.toArray().map((e=>e.id));if(r.includes(e.id))return null;if(o.includes(e.id))return null;o.push(e.id);const i={id:e.id,title:e.title,visible:e.visible,level:t,root:!1,isGroup:"layers"in e,children:[],layerRef:e};return i.isGroup&&e.layers&&(i.children=this.processLayerStructure(e.layers,t+1,o)),i})).filter((e=>null!==e&&e.title)).reverse(),this.updateLayersList=()=>{if(this.state.jimuMapView){const e=this.processLayerStructure(this.state.jimuMapView.view.map.allLayers);this.setState({layerStructure:e})}},this.handleVisibilityChange=(e,t)=>{if(this.state.jimuMapView){const o=this.state.jimuMapView.view.map.findLayerById(e);o&&(o.visible=t,this.updateLayersList())}},this.state={jimuMapView:void 0,layerStructure:[]},this.renderPromise=Promise.resolve()}render(){var o;const r=this.props.theme;console.log(r);const i=e.css`
      background: ${r.colors.palette.secondary[600]};
      color: ${r.colors.primary[400]};
      height: 100%;
      overflow-y: scroll;
      position: relative;
      scrollbar-width: thin;
      scrollbar-color: ${r.colors.palette.primary[400]} ${r.colors.palette.secondary[400]};
    `,s={id:null,title:"",visible:!1,level:0,root:!0,isGroup:!0,children:this.state.layerStructure,layerRef:void 0};return(0,e.jsx)("div",{css:i,onMouseEnter:()=>window.dispatchEvent(new Event("resize")),onMouseExit:()=>window.dispatchEvent(new Event("resize")),onClick:()=>window.dispatchEvent(new Event("resize"))},(0,e.jsx)("div",{style:{display:"none"}},(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null===(o=this.props.useMapWidgetIds)||void 0===o?void 0:o[0],onActiveViewChange:this.activeViewChangeHandler})),(0,e.jsx)(h,{mapview:this.state.jimuMapView,theme:this.props.theme,item:s,onchange:this.handleVisibilityChange}))}}function y(e){n.p=e}})(),a})())}}}));